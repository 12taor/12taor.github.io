---
title: "Plotly examples"
output: 
  html_document:
    toc: true
    toc_float: true
---

# Loading data

We're going to look at NYC Airbnb data.

```{r}
library(tidyverse)
library(p8105.datasets)
library(plotly)

```

```{r}
data("ny_noaa")

ny_noaa <- 
  separate(ny_noaa, date, into = c("year", "month", "day"), sep = ) %>% 
  mutate(
    year =
      as.numeric(year),
    month =
      as.numeric(month),
    day = 
      as.numeric(day),
    tmax =
      (as.numeric(tmax)),
    tmin =
      (as.numeric(tmin)),
    prcp =
      round(prcp * 0.03937 * 4) / 4,
    snow = 
      round(snow * 0.03937 * 4) / 4
  )

```

# Plotly plots

## scatterplot

```{r eval=FALSE, include=FALSE}
# do not run this! it takes way too long and crashes. maybe i can fix this by doing averages or something?

#ny_noaa %>% 
#  plot_ly(
#    x = ~tmax, y = ~prcp, color = ~month, text = ~month, alpha = 0.5, 
#    type = "scatter", mode = "markers"
#  )

nyc_airbnb %>% 
  mutate(text_label = str_c("Price: $", price, "\nRating: ", rating)) %>% 
  plot_ly(
    x = ~lat, y = ~long, color = ~price, text = ~text_label, 
    alpha = 0.5, type = "scatter", mode = "markers")
```

## boxplot

```{r eval=FALSE, include=FALSE}
nyc_airbnb %>% 
  mutate(neighbourhood = fct_reorder(neighbourhood, price)) %>% 
  plot_ly(
    y = ~price, x = ~neighbourhood, color = ~neighbourhood,
    type = "box", colors = "viridis")
```

## bar plot

```{r eval=FALSE, include=FALSE}
nyc_airbnb %>% 
  count(neighbourhood) %>% 
  mutate(neighbourhood = fct_reorder(neighbourhood, n)) %>% 
  plot_ly(x = ~neighbourhood, y = ~n, color = ~neighbourhood, colors = "viridis", type = "bar")
```

# ggplotly

```{r eval=FALSE, include=FALSE}
ggp_scatter =
  nyc_airbnb %>% 
  ggplot(aes(x = lat, y = long, color = price)) +
  geom_point()

ggplotly(ggp_scatter)
```

